# Secreate.io тест задание Столяров Дмитрий Андреевич "Магазин"

* [Репозиторий](https://github.com/ERRORthenBSOD/TEST_WORK_Secreate_SHOP) - gitlab


Проект содержит как бекенд так и фронтенд.

## Для запуска
Установить пакет Yarn и Nodejs 

https://yarnpkg.com/en/docs/install

https://nodejs.org/en/ 

Далее переходим в папку server проводим установку модуля для одновременного запуска бекенда и фронта
```
 cd server\
 yarn conc
```

Проводим установку нод модулей проекта

```
 yarn initInstall
```

Запускаем проект
```
 yarn dev
```
### База данных

Этот проект использует файловую базу дынных node-json-db
В директории ./server/db

Я подгрузил в базу 18 рандомных изображений.

Я предусмотрел бэкап бд на всякий случай.
Чтобы восстановить бд к изанчальному состоянию надо находясь в директории server выполнить команду

```
 yarn restoreDb
```

### Авторизация и регистрация

Авторизация реализована через логин и пароль и JWT токен!
Пароли хэшируются
Я сделал  в базе одного юзера если лень региться.

Аккаунт юзера:
```
"email": test@test.com,
"password": 12345,
```

При регистрации происходит валидация правильного значения email,
а также валидация совпадения пароля и повтора пароля.


### Серверная часть

Серверная часть реализована на nodejs express.
Работает на 9006 порту
Api предусматривает три endpoint`а: 

/products для товаров   
/currency для валют   
/user для пользователей 

Я сделал таск который каждую минуту по апи обновляет курсы валют и кладёт их в базу

Используются различные middleware для компрессии данных и решения проблем cors

Архитектура папок предусматривает возможности к удобному масштабированию проекта.

Проект по желанию можно запустить через Docker.
Файл Dockerfile я приложил.

Я написал пару тестов для проверки endpoint /products на выдачу валидных данных при запросе на этот api
запустить их можно находясь в папке /server командой

```
yarn test
```

### Клиентская часть

Проект выполнен на React 16.8 c заботой об ie9+!
Архитектура проекта позволяет удобно масштабировать проект под свои нужды!
Основные стили выполнены на библиотеке Material Ui.
Тема стилей находится в папке Themes. 

Я ипользую конфигурацию с урлами апи в config.js. 

Для расшифровки JWT использую переменную среды в файле .env - 
на продакшене её надо убрать в .gitignore

К проекту подкючен redux с одним reducer`ом для отслеживания продуктов в корзине по всему приложению.
Он подключен через combineReducers для дальнейшего удобного масштабирования.

Добавить продукт в корзину можно только выбрав перед этим колчиство хотя бы 1ед.
При добавлении еще такого же товара их количества сумируются.
На страницы магазина наверху в хедере можно увидеть быстрый просмотре корзины.

На полную версию корзины можно перейти через меню либо из магазина через меню быстрой корзины.

Расчёт вылют сделан загрузкой актуальных курсов в componentDidMount и дальнейший перерасчёт происходит по
клику на select выбора валют.


Проект по желанию можно запустить через Docker.
Файл Dockerfile я приложил. 

В проекте реализована навигация с помощью React Router Dom! 

Бандл js и css собирается с помощью webpack зашитого в модуль react-scripts 
Для правки конфигурации webpack и зависмостей можно выполнить команду, но действие будет не обратимо

```
yarn eject
```
 В проекте реализована асинхронная подгрузка компонентов и код сплитинг(в основном в роутах) с помощью
 React.lazy и React.suspense
 
 Рауты react-router-dom защищены проверко наличия токена у пользователя в localstorage.
 
 В интерфейсе предусмотрена навигация с помощью меню(поддерживается свайп)
 Дизайн выполнен в responsive стиле.
 
 Кнопкой "загрузить еще" происходит подгрузка товаров из бд, пока в ней они есть.
 При получении новых товаров происходит плавный скролл на новый блок товаров.
 При отсутсвии товаров в бд выдается предупреждение и кнопка подгрузки пропадает.
 
 
 У юзера есть возможность выйти из акканта кнопкой выхода в хедере или в меню.
 
 В своей архитектуре я использую модель controller(и модель)->view
 В папке Controllers я распологаю классовые компоненты , где сидит вся логика. Далее стейт и логику я передаю через пропсы
 в функциональные компоненты(тупые) находящиеся в папке Components. Ввиду того, что в последних версиях реакт у функциональных компонентов
 появились useState, useEffect моя архитектура усложняется, но при возможности я стараюсь основную логику
 проводить в контроллерах.
 Так же в папке Components лежат различные лейауты, 404 страница и модалка.
 Во всех компонентах, где необходимо выполнил проверку через Prop-Types. 
 
 Для связи с апи использую модуль axios , c помощью хелпера Helpers/apiRequest.js определаю по дефолту заголовок в запросах
 'Authorization = Bearer token'

## Тесты

Написал базовые тесты на валидный рендеринг компонентов со сверкой по скриншотам. А также проверку на ввод данных юзером или админом.
Запустить их можно находясь в папке ./client командой

```
yarn test
```

## Мысли
Проект состоит из двух папок server и client со своими отдельными node_modules и packages.json для того 
,чтобы при желание можно было бы легко разнести их на отдельные сервера допустим. Но при этом надо будет создать отдельные репозитории,
так как сейчас репозиторий один на обе папки.

При старте работы над проектом я долго не мог решить как мне реализовать хранение картинок на сервере.
Приходили в голову такие варианты как Redis или MongoDb - но они требовали дополнитльных установок, а мне хотелось выполнить проект
максимально независимо от сторонних программ.
Были мысли о Google Firebase и AWS S3 - но проблема в том, что они требуют аккаунт и ключи, что тоже в нашем с Вами случаем - не удобно.
Так что мой выбор пал на бд в виде файла.

Так как хранить файлы в бд - плохая идея. Я сохраняю изображения в директории на сервере /images , а в бд храню ссылку на них и информацию.

Разрабатывая свои проекты, я всегда стараюсь их делать максимально масштабируемыми с оглядкой на возможное будущее.



